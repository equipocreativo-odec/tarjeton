<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tarjetón Interactivo – Consulta del Frente por la Vida</title>
  <style>
    :root{--accent:#274690;--accent-2:#28a745;--bg:#f6f7fb;--card:#ffffff;--text:#1f2937;--muted:#6b7280;--border:#e5e7eb;--danger:#cc0000}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif}
    .wrap{max-width:1100px;margin:24px auto;padding:16px}
    h1{margin:0 0 8px;font-size:clamp(20px,3.6vw,28px)}
    .sub{color:var(--muted);margin-bottom:16px}
    .panel{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:16px;box-shadow:0 1px 3px rgba(0,0,0,.06)}
    .steps{display:grid;gap:8px;margin:8px 0 14px;padding-left:18px}
    .grid{display:grid;gap:12px;grid-template-columns: repeat( auto-fit, minmax(240px, 1fr) )}
    .candidate{position:relative;background:var(--card);border:2px solid var(--border);border-radius:14px;padding:12px;min-height:320px;display:flex;flex-direction:column;gap:10px;cursor:pointer;transition:.15s border-color,.15s box-shadow;outline:none}
    .candidate:hover{border-color:#cfd6e5;box-shadow:0 2px 10px rgba(0,0,0,.06)}
    .candidate.selected{border-color:var(--accent);box-shadow:0 0 0 3px rgba(39,70,144,.15)}
    .name{font-weight:800;line-height:1.15}
    .photoBox{display:flex;align-items:center;justify-content:center;background:#fafbff;border:1px solid #e7eaf5;border-radius:10px;padding:8px;min-height:200px;overflow:hidden}
    .photoBox img{max-width:100%;max-height:240px;object-fit:contain}
    .mark{position:absolute;inset:8px;display:none;place-items:center;pointer-events:none}
    .mark img{width:68%;max-width:220px;opacity:.9;transform:rotate(-8deg);user-select:none}
    .candidate.selected .mark{display:grid}
    .controls{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-top:14px}
    button{border:1px solid var(--border);background:var(--accent);color:#fff;border-radius:10px;padding:10px 14px;font-weight:600;cursor:pointer}
    button.secondary{background:#fff;color:var(--text)}
    .summary{margin-top:8px;padding:10px 12px;border-left:4px solid var(--accent-2);background:#eef8f1;border-radius:8px}
    .sr{position:absolute;left:-9999px}
  </style>
  <script src="config.js"></script>
</head>
<body>
  <div class="wrap">
    <h1>Consulta del Frente por la Vida – Tarjetón Pedagógico</h1>
    <p class="sub">Este tarjetón usa tus imágenes **tal cual las coloques** en la misma carpeta del HTML. Los nombres de archivo se usan para contar votos en tu hoja.</p>

    <div class="panel" aria-labelledby="instrucciones">
      <h2 id="instrucciones" style="margin:.2rem 0 .4rem;font-size:1.05rem">¿Cómo votar en el ejercicio?</h2>
      <ol class="steps">
        <li>Haz clic (o usa <kbd>Tab</kbd> + <kbd>Enter</kbd>/<kbd>Espacio</kbd>) para <strong>marcar una única opción</strong>.</li>
        <li>Se mostrará una <strong>X</strong> sobre el recuadro seleccionado.</li>
        <li>Presiona <strong>Enviar voto</strong> para registrar el nombre del archivo en tu Google Sheet.</li>
      </ol>
    </div>

    <div class="grid" role="radiogroup" aria-label="Tarjetón – Selecciona un candidato" id="grid">
      <!-- Las imágenes deben estar junto al HTML con estos nombres exactos -->
      <div class="candidate" role="radio" tabindex="0" aria-checked="false" data-file="Daniel Quintero.png">
        <div class="name">DANIEL QUINTERO</div>
        <div class="photoBox"><img src="Daniel Quintero.png" alt="Daniel Quintero.png"></div>
        <div class="mark"><img src="X.png" alt="Marca X"></div>
      </div>
      <div class="candidate" role="radio" tabindex="0" aria-checked="false" data-file="Edinson Torres.png">
        <div class="name">EDISON TORRES</div>
        <div class="photoBox"><img src="Edinson Torres.png" alt="Edinson Torres.png"></div>
        <div class="mark"><img src="X.png" alt="Marca X"></div>
      </div>
      <div class="candidate" role="radio" tabindex="0" aria-checked="false" data-file="Hector Pineda.png">
        <div class="name">HECTOR PINEDA</div>
        <div class="photoBox"><img src="Hector Pineda.png" alt="Hector Pineda.png"></div>
        <div class="mark"><img src="X.png" alt="Marca X"></div>
      </div>
      <div class="candidate" role="radio" tabindex="0" aria-checked="false" data-file="Roy Barreras.png">
        <div class="name">ROY BARRERAS</div>
        <div class="photoBox"><img src="Roy Barreras.png" alt="Roy Barreras.png"></div>
        <div class="mark"><img src="X.png" alt="Marca X"></div>
      </div>
      <div class="candidate" role="radio" tabindex="0" aria-checked="false" data-file="Martha Bernal.png">
        <div class="name">MARTHA BERNAL</div>
        <div class="photoBox"><img src="Martha Bernal.png" alt="Martha Bernal.png"></div>
        <div class="mark"><img src="X.png" alt="Marca X"></div>
      </div>
    </div>

    <div class="controls">
      <button id="btnEnviar" title="Enviar el voto a la hoja">Enviar voto</button>
      <button class="secondary" id="btnLimpiar" title="Quitar la marca">Limpiar</button>
      <span id="live" class="sr" aria-live="polite"></span>
    </div>

    <div class="summary" id="resumen" hidden>
      <strong>Seleccionaste:</strong> <span id="seleccion"></span>
    </div>
  </div>

  <script>
    const cards = Array.from(document.querySelectorAll('.candidate'));
    const resumen = document.getElementById('resumen');
    const seleccionTxt = document.getElementById('seleccion');
    const live = document.getElementById('live');

    function setSelected(card){
      cards.forEach(c=>{ const isSel = (c===card); c.classList.toggle('selected', isSel); c.setAttribute('aria-checked', isSel ? 'true' : 'false'); });
      const f = getSelectedFile();
      seleccionTxt.textContent = f ? f : 'Sin selección';
      resumen.hidden = false;
      announce('Opción seleccionada');
    }

    function getSelectedCard(){ return cards.find(c => c.classList.contains('selected')) || null; }
    function getSelectedFile(){ const c = getSelectedCard(); return c ? c.dataset.file : null; }
    function announce(msg){ live.textContent=''; setTimeout(()=>live.textContent=msg, 10); }

    cards.forEach(c=>{
      c.addEventListener('click', ()=> setSelected(c));
      c.addEventListener('keydown', (e)=>{
        if(e.key==='Enter' || e.key===' '){ e.preventDefault(); setSelected(c); }
        const idx = cards.indexOf(c);
        if(e.key==='ArrowRight' || e.key==='ArrowDown'){ e.preventDefault(); cards[(idx+1)%cards.length].focus(); }
        if(e.key==='ArrowLeft' || e.key==='ArrowUp'){ e.preventDefault(); cards[(idx-1+cards.length)%cards.length].focus(); }
      });
    });

    document.getElementById('btnLimpiar').addEventListener('click', ()=>{
      cards.forEach(c=>{ c.classList.remove('selected'); c.setAttribute('aria-checked','false'); });
      seleccionTxt.textContent = 'Sin selección'; resumen.hidden = false; announce('Selección borrada');
    });

    async function enviar(){
      const file = getSelectedFile();
      if(!file){ alert('Primero selecciona una opción.'); return; }
      if(!window.SHEETS_ENDPOINT){ alert('Falta configurar SHEETS_ENDPOINT en config.js'); return; }
      try{
        const res = await fetch(window.SHEETS_ENDPOINT, { method:'POST', mode:'cors', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ filename:file, ts: new Date().toISOString() }) });
        if(!res.ok) throw new Error('HTTP '+res.status);
        alert('Voto registrado: '+file);
      }catch(err){
        console.error(err); alert('No se pudo registrar. Revisa el endpoint en config.js.');
      }
    }

    document.getElementById('btnEnviar').addEventListener('click', enviar);
  </script>
</body>
</html>
